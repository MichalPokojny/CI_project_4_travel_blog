{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block profile %}active{% endblock %}
{% block content %}

<div class="container-fluid">
  <div class="row g-0">
    <div class="col">
      <div class="auth">
        <h1 class="text-center font-blue">Profile</h1>
        <div class="container mt-5">
          <table>
            <tr>
              <td class="float-end"><h5 class="font-blue">Username :</h5></td> <td><h5>{{ user.username }}</h5></td>
            </tr>
            <tr>
              <td class="float-end"><h5 class="font-blue">Email :</h5></td> <td><h5>{{ user.email }}</h5></td>
            </tr>
            <tr>
              <td class="float-end"><h5 class="font-blue">Registered :</h5></td> <td><h5>{{ user.date_joined|date:"F j, Y" }}</h5></td>
            </tr>
            <tr>
              <td class="float-end"><h5 class="font-blue">Logged in :</h5></td> <td><h5>{{ user.last_login| timesince }}</h5></td>
            </tr>
          </table>
          <div class="text-center">
          <button type="button" class="btn btn-secondary rounded-pill mt-3" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</button>
          </div>
          <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
                </div>
                <div class="modal-body">
                  <form method="POST" action="{% url 'profile_view' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form | crispy }}
                    {% if redirect_field_value %}
                    <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
                    {% endif %}
                    <div class="modal-footer">
                      <button class="btn btn-secondary" type="submit">Update</button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </form>
                  {% if messages %}
                  {% for message in messages %}
                  <script>
                    alert('{{ message }}')
                  </script>
                  {% endfor %}
                  {% endif %}
                </div>
                
              </div>
            </div>
          </div>
          {% if posts %}
          <ul style="padding-left: 0;">
          <h3 class="text-center mt-5 mb-3" style="color:#111c79;">Your blog posts</h3>
          {% for post in posts %}
          <li><p>{{forloop.counter}}. {{ post.title }} <a href="{% url 'update_post' post.slug %}">(Update)</a>
                 <a href="{% url 'delete_post' post.slug %}"> (Delete)</a></p></li>
          <hr>
          {% endfor %}
          </ul>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
