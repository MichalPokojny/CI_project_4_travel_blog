{% extends "base.html" %}
{% block blog %}active{% endblock %}
{% load static %}
{% block content %}
{% load crispy_forms_tags %}

<div class="container-fluid mt-5 mb-4 g-0">
    <div class="row g-0 text-center">
        <!-- <h1> category here </h1> -->
    </div>
    <div class="row g-0 text-center">
        <h2>{{ post.title }}</h2>
    </div>
    
    <div class="row g-0 mb-3 text-center">
        <p style="font-size: 0.8em;">{{ post.author }} | {{ post.created_on }} | {{ post.category }} | <i class="fas fa-heart"></i> {{ post.number_of_likes }} | <i class="fa-regular fa-comment"></i> {{ post.comment_count }} {% if request.user == post.author or request.user.is_superuser %} | 
            <a href="{% url 'update_post' post.slug %}">(Update)</a> <a href="{% url 'delete_post' post.slug %}"> (Delete)</a>{% endif %}</p>
    </div>
    <div class="welcome-box">
    <div class="row g-0 mb-3 p-3">
        <img src="{{ post.featured_image.url }}" style="width:100%; height:100%;">
    </div>
    <div class="row g-0">
        <div class="col-md-7 p-5 text-center">
        <p>{{ post.content | safe }} </p> 
        </div>
        <div class="col-md-5 p-5">
            <img src="https://res.cloudinary.com/doh67artq/image/upload/v1677884179/static/carousel-image/person-back2_fyzq4e.jpg" style="width:350px; height:350px">
        </div>
        {% if user.is_authenticated %}
        <div class="row g-0">
            <form action="{% url 'blog_likes' post.slug %}" method="POST" class="m-3">
                {% csrf_token %}
                {% if liked %}
                <button type="submit" name="post_id" value="{{ post.slug }}" class="btn btn-secondary rounded-pill"><i class="fas fa-heart"></i> Unlike</button>
                {% else %}
                <button type="submit" name="post_id" value="{{ post.slug }}" class="btn btn-secondary rounded-pill"><i class="far fa-heart"></i> Like</button>
                {% endif %}
            </form>
        </div>
        {% endif %}
        <div class="containter m-3">
        <div class="row g-0">
            <h1 class="me-1">Comments</h1>
        </div>
        {% for comment in comments %}
        <div class="row g-0 mt-3 p-2" style="max-width: 90%; background-color: #c5c5c51c; border-radius: 3%;">
            {{ comment.name }} | {{ comment.created_on }} <hr>{{ comment.body | linebreaks }}
        </div>
        {% endfor %}
        {% if commented %}
        <div class="alert alert-success" role="alert" style="width: fit-content; margin: 25px auto;">
            Your comment is awaiting for approval
        </div>
        {% else %}
        <div class="row g-0 m-3">
            {% if user.is_authenticated %}
            
            <h3 style="color: #FFF">Leave a comment:</h3>
            <p>Posting as: {{ user.username }}</p>
            <form method="post" style="width: 90%;">
                {{ comment_form | crispy }}
                {% csrf_token %}
                <button type="submit" class="btn btn-secondary rounded-pill mt-3 float-end">Submit</button>
            </form>
            {% endif %}
            {% endif %}
        </div>
    </div>
    </div>
</div>
</div>
{% endblock %}