<!-- Extend base template and load static files -->
{% extends "base.html" %}
{% load static %}
<!-- Set active class link in the navbar -->
{% block blog %}active{% endblock %}
{% block content %}
<!-- Load crispy forms -->
{% load crispy_forms_tags %}
<!-- Container to display the post detail -->
<div class="container-fluid mt-5 mb-4 g-0">
    <div class="row g-0 text-center">
        <h2>{{ post.title }}</h2>
    </div>
    
    <div class="row g-0 mb-3 text-center">
        <!-- Display the author, date created, category, number of likes, number of comments of the post-->
        <p style="font-size: 0.8em;">{{ post.author }} | {{ post.created_on }} | {{ post.category }} | <i class="fas fa-heart"></i> {{ post.number_of_likes }} | <i class="fa-regular fa-comment"></i> {{ post.comment_count }}
            <!-- Display links to update or delete the post if the user is its author or superuser -->
             {% if request.user == post.author or request.user.is_superuser %} | 
            <a href="{% url 'update_post' post.slug %}">(Update)</a> <a href="{% url 'delete_post' post.slug %}"> (Delete)</a>{% endif %}</p>
    </div>
    <div class="welcome-box">
    <div class="row g-0 mb-3 p-3">
         <!-- Display featured image of post, or default one if dont have any -->
        {% if "placeholder" in post.featured_image.url %}
        <img src="https://c.pxhere.com/photos/3f/47/travel_journal_camera_map_notebook-120138.jpg!d" srcset="https://c.pxhere.com/photos/3f/47/travel_journal_camera_map_notebook-120138.jpg!d" alt="notebook, camera, travel" style="width:100%; height:100%;">
        {% else %}
        <img src="{{ post.featured_image.url }}" style="width:100%; height:100%;">
        {% endif %}
    </div>
    <div class="row g-0">
        <div class="container text-center">
        <p>{{ post.content | safe }} </p> 
        </div>
        <!-- Display like or unlike button for authenticated users -->
        {% if user.is_authenticated %}
        <div class="row g-0">
            <form action="{% url 'blog_likes' post.slug %}" method="POST" class="m-3">
                {% csrf_token %}
                {% if liked %}
                <button type="submit" name="post_id" value="{{ post.slug }}" class="btn btn-secondary rounded-pill"><i class="fas fa-heart"></i> Unlike</button>
                {% else %}
                <button type="submit" name="post_id" value="{{ post.slug }}" class="btn btn-secondary rounded-pill"><i class="far fa-heart"></i> Like</button>
                {% endif %}
            </form>
        </div>
        {% endif %}
        <!-- Comments section -->
        <div class="containter m-3">
        <div class="row g-0">
            <h1 class="me-1">Comments</h1>
        </div>
        <!-- Loop and show every approved comment -->
        {% for comment in comments %}
        <div class="row g-0 mt-3 p-2" style="max-width: 90%; background-color: #c5c5c51c; border-radius: 3%;">
            {{ comment.name }} | {{ comment.created_on }} <hr>{{ comment.body | linebreaks }}
        </div>
        {% endfor %}
        <!-- After commented show message awaiting approval -->
        {% if commented %}
        <div class="alert alert-success" role="alert" style="width: fit-content; margin: 25px auto;">
            Your comment is awaiting for approval
        </div>
        {% else %}
        <div class="row g-0 m-3">
            <!-- Display add comment form if user authenticated-->
            {% if user.is_authenticated %}
            
            <h3 style="color: #FFF">Leave a comment:</h3>
            <p>Posting as: {{ user.username }}</p>
            <form method="post" style="width: 90%;">
                {{ comment_form | crispy }}
                {% csrf_token %}
                <button type="submit" class="btn btn-secondary rounded-pill mt-3 float-end">Submit</button>
            </form>
            {% endif %}
            {% endif %}
        </div>
    </div>
    </div>
</div>
</div>
{% endblock %}